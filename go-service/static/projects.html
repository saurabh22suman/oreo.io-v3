<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Projects CRUD</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 2rem; }
      input, textarea, button { padding: 0.5rem; margin: 0.25rem 0; width: 360px; }
      ul { padding: 0; list-style: none; }
      li { margin: 0.25rem 0; }
      code { background: #f5f5f5; padding: 0.25rem 0.5rem; }
    </style>
  </head>
  <body>
    <h1>Projects CRUD</h1>
    <p>Use the Auth Tester to get a token first: <a href="/ui/auth.html">/ui/auth.html</a></p>
    <label>Bearer Token</label><br />
    <input id="token" placeholder="paste token here" /><br />
    <h2>Create</h2>
    <input id="name" placeholder="Project name" />
    <textarea id="desc" placeholder="Description"></textarea><br />
    <button id="create">Create</button>
    <h2>List</h2>
    <button id="refresh">Refresh List</button>
    <ul id="list"></ul>
    <pre id="out"></pre>
    <script>
      const out = document.getElementById('out');
      function show(obj){ out.textContent = JSON.stringify(obj, null, 2); }
      const base = location.origin + '/api/projects';

      async function authed(method, url, body) {
        const t = document.getElementById('token').value.trim();
        const headers = t ? { 'Authorization': 'Bearer ' + t } : {};
        if (body) headers['Content-Type'] = 'application/json';
        const resp = await fetch(url, { method, headers, body: body ? JSON.stringify(body) : undefined });
        let data; try { data = await resp.json(); } catch { data = await resp.text(); }
        return { status: resp.status, data };
      }

      async function refreshList() {
        const { status, data } = await authed('GET', base);
        show({ status, data });
        const list = document.getElementById('list');
        list.innerHTML = '';
        (Array.isArray(data) ? data : []).forEach(p => {
          const li = document.createElement('li');
          li.innerHTML = `<code>#${p.id}</code> ${p.name} â€” <small>${p.description||''}</small> ` +
            `<button data-id="${p.id}" class="edit">Edit</button> ` +
            `<button data-id="${p.id}" class="del">Delete</button>`;
          list.appendChild(li);
        });
      }

      document.getElementById('refresh').onclick = refreshList;
      document.getElementById('create').onclick = async () => {
        const name = document.getElementById('name').value.trim();
        const description = document.getElementById('desc').value.trim();
        const r = await authed('POST', base, { name, description });
        show(r);
        await refreshList();
      };

      document.getElementById('list').addEventListener('click', async (e) => {
        const id = e.target.getAttribute('data-id');
        if (e.target.className === 'del') {
          const r = await authed('DELETE', `${base}/${id}`);
          show(r);
          await refreshList();
        } else if (e.target.className === 'edit') {
          const name = prompt('New name?');
          const description = prompt('New description?');
          if (name !== null) {
            const r = await authed('PUT', `${base}/${id}`, { name, description });
            show(r);
            await refreshList();
          }
        }
      });
    </script>
  </body>
  </html>
